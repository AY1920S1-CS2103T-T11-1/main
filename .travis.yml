language: java

matrix:
  include:
    # Ubuntu Linux (xenial) / Oracle JDK 11 / Headed (AWT Robot) [Also the build that uploads Javadocs/Snapshots]
    - os: linux
      dist: xenial
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="--add-opens=java.base/java.util=ALL-UNNAMED -Dtestfx.robot=awt"
    # Ubuntu Linux (xenial) / Oracle JDK 11 / Headed (AWT Robot) / HiDPI
    - os: linux
      dist: xenial
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="--add-opens=java.base/java.util=ALL-UNNAMED -Dtestfx.robot=awt -Dglass.gtk.uiScale=2.0"
    # Ubuntu Linux (xenial) / Oracle JDK 11 / Headed (Glass Robot)
    - os: linux
      dist: xenial
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="--add-opens=java.base/java.util=ALL-UNNAMED -Dtestfx.robot=glass"
    # Ubuntu Linux (xenial) / Oracle JDK 11 / Headed (Glass Robot) / HiDPI
    - os: linux
      dist: xenial
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="--add-opens=java.base/java.util=ALL-UNNAMED -Dtestfx.robot=glass -Dglass.gtk.uiScale=2.0"
    # Ubuntu Linux (xenial) / Oracle JDK 11 / Headless (Glass Robot)
    - os: linux
      dist: xenial
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="--add-opens=java.base/java.util=ALL-UNNAMED -Djava.awt.headless=true -Dtestfx.robot=glass -Dtestfx.headless=true -Dprism.order=sw"
    # Ubuntu Linux (xenial) / Oracle JDK 11 / Headless (Glass Robot) / HiDPI
    - os: linux
      dist: xenial
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="--add-opens=java.base/java.util=ALL-UNNAMED -Djava.awt.headless=true -Dtestfx.robot=glass -Dtestfx.headless=true -Dprism.order=sw -Dglass.gtk.uiScale=2.0"
    # macOS / OpenJDK 12 / Headless
    - os: osx
      osx_image: xcode9.4
      jdk: openjdk11
      env:
        - _JAVA_OPTIONS="-Djava.awt.headless=true -Dtestfx.robot=glass -Dtestfx.headless=true -Dprism.order=sw"



https://docs:
  travis-ci:
    com/user/common-build-problems/#build-times-out-because-no-output-was-received:
before_install:
  - if [[ "${TRAVIS_OS_NAME}" == linux ]]; then export DISPLAY=:99.0; sh -e /etc/init.d/xvfb start; fi

install: true

before_script:
  - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then export DISPLAY=:99.0 && /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1280x1024x16; fi


script: >-
    ./config/travis/run-checks.sh &&
    ./gradlew clean checkstyleMain checkstyleTest test coverage coveralls asciidoctor

deploy:
  skip_cleanup: true
  provider: script
  script: ./config/travis/deploy_github_pages.sh
  on:
    branch: master

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
